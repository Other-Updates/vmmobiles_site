{{ header }}
{{ column_left }}
    {% if column_left and column_right %}
    {% set class = 'col-sm-6' %}
    {% elseif column_left or column_right %}
    {% set class = 'col-sm-9' %}
    {% else %}
    {% set class = 'col-sm-12' %}
    {% endif %}

    <div id="content" class="{{ class }}">
        <div class="content-top">   
             {{ content_top }}
             {% if login_check %}

             {% else %}
                <div class="modal fade loginotp" id="modalLoginForm" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content">
                            <div class="modal-header text-center">
                                <h4 class="modal-title w-100 font-weight-bold">Login</h4>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
    
                                </button>
                            </div>
                            <form action="{{ action }}" method="post" enctype="multipart/form-data">
                                <div class="modal-body mx-3">
                                    <div class="form-group">
                                        <label class="control-label" for="input-email">Mobile No</label>
                                        <input type="text" name="email" value="" placeholder="" id="input-email" class="form-control user_account_mobile" />
                                    </div>
                                    <div class="form-group">
                                        <input type="button" class="btn btn-primary get_otp send-otp" value="Send OTP" /> 
                                        <input type="button" class="btn btn-primary skip_form_login" value="Skip Login" data-dismiss="modal" aria-label="Close" /> 
                                    </div>
                                    <div class="form-group">
                                        <input type="checkbox" id="skip_form" class="" value="Active"/>
                                        <label for="skip_form"> Don't show this again</label>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                 </div>
                 <div class="modal fade loginotp" id="modalLoginOtp" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header text-center">
                                <h4 class="modal-title w-100 font-weight-bold">Login</h4>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                                </button>
                            </div>

                            <form action="{{ action }}" method="post" enctype="multipart/form-data">
                                <div class="modal-body mx-3">
                                    <div class="form-group">
                                    <label class="form-group number_change_label" for=""></label>
                                    <input type="button" class="change_number" title="Change Mobile Number" value="Change"/>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label" for="input-password">Enter OTP</label>
                                        <input type="password" name="password" value="" placeholder="" id="input-password" class="form-control user_otp" autocomplete="off" />
                                    </div>
                                    <div class="form-group">
                                        <input type="button" class="btn btn-primary resend_otp" value="Resend OTP" /> 
                                        <input type="button" class="btn btn-primary otp_login" value="Verify OTP" /> 
                                    </div>
                                    <div class="form-group">
                                        <p>Please wait <span id="time">60</span> sec before requesting a new OTP.</p>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                 </div>
             {% endif %}
            </div>
        <div class="container">
            <div class="row">
    {{ content_bottom }}
    </div></div>
    {{ column_right }}
</div>
{{ footer }}

<script type="text/javascript">
var skip_form ='';
var time = $("#time");
var timer;

$(document).ready(function(){
    $(window).on('load', function() {
        if(localStorage.getItem('skip_login_checkbox')==='Active'){
            // $('#modalLoginForm').modal('show');
        }
        else{
                    $('#modalLoginForm').modal('show');

        }
        
    });
    $('#skip_form').click(function(){
        if (this.checked) {
           skip_form = this.value;
        }
        else {
           skip_form = '';
        }
    }) 

    $('.skip_form_login').click(function(){
        if(skip_form!==''){
            localStorage.setItem("skip_login_checkbox", skip_form);
            console.log(localStorage.getItem("skip_login_checkbox"));
        }
    });
    $('.get_otp,.resend_otp').click(()=>{
        var mobile_no=$('.user_account_mobile').val();
                $.ajax({
                    type: "POST",
                    url: "index.php?route=account/login/otpUpdate",
                    dataType: 'json',
                    data:{mobile_no:mobile_no},
                    success: function(data){
                        console.log(data['status']);
                        if(data['status']==='success'){
                             $('#modalLoginForm').modal('hide');
                             $('#modalLoginOtp').modal('show');
                             $('.number_change_label').text('Please enter the OTP sent to '+mobile_no+'.');
                             $('.change_number').on('click', function(){
                                $('#modalLoginOtp').modal('hide');
                                $('#modalLoginForm').modal('show');
                                clearInterval(timer);
                             });
                             $('.resend_otp').attr('disabled','disabled');
                               
                                var i = 59;
                                timer = setInterval(function() {
                                time.html(i);
                                if (i == 0) {
                                    $('.resend_otp').removeAttr('disabled');
                                    clearInterval(timer);

                                }
                                i--;
                                }, 1000)
                             
                            $('.otp_login').click(()=>{
                                 var user_otp=$('.user_otp').val();
                                $.ajax({
                                    type: "POST",
                                    url: "index.php?route=account/login/custom_login",
                                    dataType: 'json',
                                    data:{mobile_no:mobile_no,user_otp:user_otp},
                                    success: function(login_data){
                                        console.log(login_data);
                                        if(login_data['login_status']==='success'){
                                             Swal.fire({
                                                    title: 'Login Success',
                                                    text: "Login Verified Successfully",
                                                    icon: 'success',
                                                    // showCancelButton: true,
                                                    confirmButtonColor: '#3085d6',
                                                    cancelButtonColor: '#d33',
                                                    // confirmButtonText: 'Yes, delete it!'
                                                }).then((result) => {
                                                    if (result.isConfirmed) {
                                                        location.reload();
                                                    }
                                                });
                                        }
                                        else{
                                             Swal.fire({
                                                    title: 'Login Failed',
                                                    text: "One Time Password is Wrong",
                                                    icon: 'error',
                                                    // showCancelButton: true,
                                                    confirmButtonColor: '#3085d6',
                                                    cancelButtonColor: '#d33',
                                                    // confirmButtonText: 'Yes, delete it!'
                                                }).then((result) => {
                                                    if (result.isConfirmed) {
                                                        // location.reload();
                                                    }
                                                });
                                        }
                                    }
                                });
                            })
                        }
                        else
                        {
                             Swal.fire({
                                title: 'Invalid Number?',
                                text: "Mobile Number Not Found Please Check It",
                                icon: 'warning',
                                // showCancelButton: true,
                                confirmButtonColor: '#3085d6',
                                cancelButtonColor: '#d33',
                                // confirmButtonText: 'Yes, delete it!'
                            }).then((result) => {
                                if (result.isConfirmed) {
                                    // location.reload();
                                }
                            });
                        }
                    }
                });
    });
    $('.service-area-carousel').owlCarousel({
            items: 4,
            autoPlay: true,
            singleItem: false,
            navigation: true,
            navigationText: ['<i class="fa fa-chevron-left fa-5x"></i>', '<i class="fa fa-chevron-right fa-5x"></i>'],
            pagination: false,
            itemsDesktop : [1500,4],
            itemsDesktopSmall:[1199,3],
            itemsTablet :	[733,2],
            itemsTabletSmall : [575, 1],
            // itemsMobile: [479, 2]
        });

         $('#wdcmsbanner-carousel').owlCarousel({
            items: 5,
            autoPlay: true,
            singleItem: false,
            navigation: true,
            navigationText: ['<i class="fa fa-chevron-left fa-5x"></i>', '<i class="fa fa-chevron-right fa-5x"></i>'],
            pagination: false,
            itemsDesktop : [1500,5],
            itemsDesktopSmall:[1199,4],
            itemsTablet :	[991,3],
            itemsTabletSmall : [543, 2],
            itemsMobile: [479, 2]
        });
    });	
</script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/11.1.10/sweetalert2.css" rel="stylesheet" type="text/css"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/11.1.10/sweetalert2.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/11.1.10/sweetalert2.js"></script>